<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Search Players</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: auto;
      padding: 2rem;
      background: #f5f5f5;
    }
    input, button, label {
      width: 100%;
      padding: 0.75rem;
      margin: 0.5rem 0;
      font-size: 1rem;
    }
    #results {
      margin-top: 1rem;
    }
    .player-card {
      background: white;
      padding: 1rem;
      margin-bottom: 0.75rem;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .player-card strong {
      display: block;
      margin-bottom: 0.25rem;
    }
  </style>
</head>
<body>

  <h2>Search Players</h2>
  
  <input id="searchInput" placeholder="Enter UserID, Player Name, or Level" />
  <div>
    <strong>Filter by skills:</strong><br>
    <label><input type="checkbox" id="filterCoG"> CoG</label>
    <label><input type="checkbox" id="filterThorns"> Thorns</label>
    <label><input type="checkbox" id="filterVileBomb"> VileBomb</label>
    <label><input type="checkbox" id="filterWaterToad"> Water Toad</label>
    <label><input type="checkbox" id="filterLightningDivine"> Lightning Divine</label>
  </div>
  
  <button onclick="searchPlayers()">Search</button>
  
  <div id="results"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDnG1aqgL2hr-kZ_Sst7oHOGzgfDW4Ulnk",
      authDomain: "nmdb-983db.firebaseapp.com",
      projectId: "nmdb-983db"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function searchPlayers() {
      const queryValue = document.getElementById('searchInput').value.trim();
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = ''; // Clear previous results

      if (!queryValue) {
        resultsDiv.textContent = 'Please enter a search term.';
        return;
      }

      let query = db.collection('players');
      const skills = [];

      // Check skills checkboxes
      if (document.getElementById('filterCoG').checked) skills.push('CoG');
      if (document.getElementById('filterThorns').checked) skills.push('Thorns');
      if (document.getElementById('filterVileBomb').checked) skills.push('VileBomb');
      if (document.getElementById('filterWaterToad').checked) skills.push('Water Toad');
      if (document.getElementById('filterLightningDivine').checked) skills.push('Lightning Divine');
      
      if (skills.length > 0) {
        query = query.where('skills', 'array-contains-any', skills);
      }

      query = query.where('playername', '==', queryValue).get()
        .then(snapshot => {
          if (snapshot.empty) {
            resultsDiv.textContent = 'No results found.';
            return;
          }
          
          snapshot.forEach(doc => {
            const player = doc.data();
            const playerCard = document.createElement('div');
            playerCard.classList.add('player-card');
            playerCard.innerHTML = `
              <strong>UserID: ${doc.id}</strong>
              <strong>Player Name: ${player.playername}</strong>
              <strong>Level: ${player.level}</strong>
              <strong>Skills: ${player.skills.join(', ')}</strong>
            `;
            resultsDiv.appendChild(playerCard);
          });
        }).catch(err => {
          resultsDiv.textContent = 'Error retrieving data: ' + err.message;
        });
    }
  </script>
</body>
</html>
